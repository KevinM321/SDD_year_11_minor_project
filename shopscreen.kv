#:set top_height 45
#:import CardTransition kivy.uix.screenmanager.CardTransition

# link to screen manager
<ShopScreen@Screen>:
    name: 'shop_screen'
    screen_manager: self.screen_manager

    ShopScreenLayout:
        screen_manager: root.screen_manager

# appearance of an interface button used for screen header and footer
<InterfaceButton>:
    size_hint: None, None
    markup: True
    font_size: 15
    size: 100, 45

# display of item button
<ItemButton>:
    Image:
        source: root.img_path
        pos_hint: {"bottom": 0}

# display of image button inside item popup
<ImageButton>:
    size_hint: None, None
    size: 200, 100
    pos_hint: {'center_x': .5}
    id: img_path

# layout of screen header
<ToolBarHeader>:
    orientation: 'horizontal'
    id: screen_manager
    size_hint: 1, None
    height: top_height
    canvas:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size

    InterfaceButton:
        on_release: root.screen_manager.transition = FadeTransition()
        on_release: root.screen_manager.current = 'shop_screen'
        background_normal: 'res/Images/home_button.png'
        background_down: 'res/Images/home_button.png'
        size: 45, 45

    Label:
        pos: 0, 1
        size_hint: .8, 1
    InterfaceButton:
        on_press: root.screen_manager.transition = FadeTransition()
        on_release: root.screen_manager.current = 'profile_screen'
        text: '[b]Profile[/b]'
    InterfaceButton:
        on_press: root.screen_manager.transition = FadeTransition()
        on_release: root.screen_manager.current = "cart_screen"
        text: '[b]Cart[/b]'
    InterfaceButton:
        on_press: root.screen_manager.transition = FadeTransition()
        on_release: root.screen_manager.current = 'lucky_draw_screen'
        text: '[b]Lucky Draw[/b]'

# appearance of screen footer
<ToolBarFooter>:
    orientation: 'horizontal'
    size_hint: 1, None
    height: top_height
    canvas:
        Color:
            rgba: 0.125, 0.125, 0.125, 1
        Rectangle:
            pos: self.pos
            size: self.size

# layout for each item popup
<PopupLayout>:
    orientation: 'vertical'
    ImageButton:
        img_path: root.img_path
        source: root.img_path
        markup: True
    Label:
        bold: True
        text: '$' + str(root.price)
    Label:
        text: root.description
    # layout for adding and removing item from cart
    BoxLayout:
        Button:
            text:'-'
            on_release:
                try: root.quantity -= 1
                except ValueError: pass
        Label:
            text: str(root.quantity)
        Button:
            text: '+'
            on_release:
                try: root.quantity += 1
                except ValueError: pass

# layout for shop screen
<ShopScreenLayout>:
    orientation: 'vertical'
    id: screen_manager
    screen_manager: root.screen_manager
    spacing: 20
    # adding background image and shelf lines
    canvas.before:
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'res/Images/metal_shelf.png'
        Line:
            points: self.x + self.width/10, self.y + self.height/1.375, self.x + self.width/1.1, self.y + self.height/1.375
            width: 2
        Line:
            points: self.x + self.width/10, self.y + self.height/1.9, self.x + self.width/1.1, self.y + self.height/1.9
            width: 2
        Line:
            points: self.x + self.width/10, self.y + self.height/3.1, self.x + self.width/1.1, self.y + self.height/3.1
            width: 2
        Line:
            points: self.x + self.width/10, self.y + self.height/8, self.x + self.width/1.1, self.y + self.height/8
            width: 2

    ToolBarHeader:
        screen_manager: root.screen_manager

    # item layout
    ItemLayout:
        cols: 3
        padding: 10
        spacing: 30

    ToolBarFooter:
        Label:
            pos: 0, 1
            size_hint: .8, 1
        InterfaceButton:
            text: '[b]Checkout[/b]'
            on_press: root.screen_manager.transition = FadeTransition()
            on_release: root.screen_manager.current = "cart_screen"
